!function (e, t) { "object" == typeof exports && "object" == typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define([], t) : "object" == typeof exports ? exports["Viewing.Extension.Transform"] = t() : e["Viewing.Extension.Transform"] = t() }(this, function () {
	return function (e) { function t(i) { if (n[i]) return n[i].exports; var r = n[i] = { exports: {}, id: i, loaded: !1 }; return e[i].call(r.exports, r, r.exports, t), r.loaded = !0, r.exports } var n = {}; return t.m = e, t.c = n, t.p = "", t(0) }({
		0: function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function o(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function a(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } var s = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), c = n(82), l = i(c), h = n(81), u = i(h), p = n(8), E = i(p), m = n(6), f = i(m), v = function (e) { function t(e) { var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; r(this, t); var i = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, n)); return i.translateTool = new l.default(e), i._viewer.toolController.registerTool(i.translateTool), i.rotateTool = new u.default(e), i._viewer.toolController.registerTool(i.rotateTool), i } return a(t, e), s(t, [{ key: "load", value: function () { var e = this; if (this._txControl = f.default.createButton("toolbar-translate", "fa fa-arrows-alt", "Translate Tool", function () { var t = e.translateTool.getName(), n = e.rotateTool.getName(); e.translateTool.active ? (e._viewer.toolController.deactivateTool(t), e._txControl.container.classList.remove("active"), e._comboCtrl.container.classList.remove("active")) : (e._viewer.toolController.activateTool(t), e._txControl.container.classList.add("active"), e._viewer.toolController.deactivateTool(n), e._rxControl.container.classList.remove("active"), e._comboCtrl.container.classList.add("active")) }), this._rxControl = f.default.createButton("toolbar-rotate", "fa fa-refresh", "Rotate Tool", function () { var t = e.translateTool.getName(), n = e.rotateTool.getName(); e.rotateTool.active ? (e._viewer.toolController.deactivateTool(n), e._rxControl.container.classList.remove("active"), e._comboCtrl.container.classList.remove("active")) : (e._viewer.toolController.activateTool(n), e._rxControl.container.classList.add("active"), e._viewer.toolController.deactivateTool(t), e._txControl.container.classList.remove("active"), e._comboCtrl.container.classList.add("active")) }), this.parentControl = this._options.parentControl, !this.parentControl) { var t = this._viewer.getToolbar(!0); this.parentControl = new Autodesk.Viewing.UI.ControlGroup("transform"), t.addControl(this.parentControl) } this._comboCtrl = new Autodesk.Viewing.UI.ComboButton("transform-combo"), this._comboCtrl.setToolTip("Transform Tools"), this._comboCtrl.icon.style.fontSize = "24px", this._comboCtrl.icon.style.transform = "rotateY(180Deg)", this._comboCtrl.icon.className = "glyphicon glyphicon-wrench", this._txControl.icon.className = "glyphicon glyphicon-fullscreen", this._rxControl.icon.className = "glyphicon glyphicon-repeat", this._comboCtrl.addControl(this._txControl), this._comboCtrl.addControl(this._rxControl); var n = this._comboCtrl.onClick; return this._comboCtrl.onClick = function (t) { if (e._comboCtrl.container.classList.contains("active")) { e._txControl.container.classList.remove("active"), e._rxControl.container.classList.remove("active"), e._comboCtrl.container.classList.remove("active"); var i = e.translateTool.getName(), r = e.rotateTool.getName(); e._viewer.toolController.deactivateTool(i), e._viewer.toolController.deactivateTool(r) } else n() }, this.parentControl.addControl(this._comboCtrl), console.log("Viewing.Extension.Transform loaded"), !0 } }, { key: "unload", value: function () { this.parentControl.removeControl(this._comboCtrl), this._viewer.toolController.deactivateTool(this.translateTool.getName()), this._viewer.toolController.deactivateTool(this.rotateTool.getName()), console.log("Viewing.Extension.Transform unloaded") } }], [{ key: "ExtensionId", get: function () { return "Viewing.Extension.Transform" } }]), t }(E.default); Autodesk.Viewing.theExtensionManager.registerExtension(v.ExtensionId, v) }, 2: function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(5), o = i(r); o.default.Composer = r.EventsEmitterComposer, t.default = o.default }, 5: function (e, t) { "use strict"; function n(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function i(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(t, "__esModule", { value: !0 }); var o = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), a = function () { function e() { r(this, e), this._events = {} } return o(e, [{ key: "on", value: function (e, t) { var n = this; return e.split(" ").forEach(function (e) { n._events[e] = n._events[e] || [], n._events[e].push(t) }), this } }, { key: "off", value: function (e, t) { var n = this; return void 0 == e ? void (this._events = {}) : (e.split(" ").forEach(function (e) { e in n._events != !1 && (t ? n._events[e].splice(n._events[e].indexOf(t), 1) : n._events[e] = []) }), this) } }, { key: "emit", value: function (e) { if (void 0 !== this._events[e]) for (var t = this._events[e].slice(), n = 0; n < t.length; ++n) { var i = t[n].apply(this, Array.prototype.slice.call(arguments, 1)); if (void 0 !== i) return i } } }, { key: "guid", value: function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "xxxxxxxxxxxx", n = (new Date).getTime(), e = t.replace(/[xy]/g, function (e) { var t = (n + 16 * Math.random()) % 16 | 0; return n = Math.floor(n / 16), ("x" == e ? t : 7 & t | 8).toString(16) }); return e } }]), e }(); t.default = a; t.EventsEmitterComposer = function (e) { return function (e) { function t(e, i, o, a, s) { r(this, t); var c = n(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, i, o, a, s)); return c._events = {}, c } return i(t, e), o(t, [{ key: "on", value: function (e, t) { var n = this; return e.split(" ").forEach(function (e) { n._events[e] = n._events[e] || [], n._events[e].push(t) }), this } }, { key: "off", value: function (e, t) { var n = this; return void 0 == e ? void (this._events = {}) : (e.split(" ").forEach(function (e) { e in n._events != !1 && (t ? n._events[e].splice(n._events[e].indexOf(t), 1) : n._events[e] = []) }), this) } }, { key: "emit", value: function (e) { if (void 0 !== this._events[e]) for (var t = this._events[e].slice(), n = 0; n < t.length; ++n) { var i = t[n].apply(this, Array.prototype.slice.call(arguments, 1)); if (void 0 !== i) return i } } }, { key: "guid", value: function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "xxxxxxxxxxxx", n = (new Date).getTime(), e = t.replace(/[xy]/g, function (e) { var t = (n + 16 * Math.random()) % 16 | 0; return n = Math.floor(n / 16), ("x" == e ? t : 7 & t | 8).toString(16) }); return e } }]), t }(e) } }, 6: function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(9), o = i(r); t.default = o.default }, 7: function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function o(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" != typeof t && "function" != typeof t ? e : t } function a(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t) } Object.defineProperty(t, "__esModule", { value: !0 }); var s = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), c = n(2), l = i(c), h = function (e) { function t(e) { var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; r(this, t); var i = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, n)); return i._viewer = e, i._options = n, i._events = {}, i } return a(t, e), s(t, [{ key: "load", value: function () { return !0 } }, { key: "unload", value: function () { return !0 } }], [{ key: "guid", value: function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "xxxxxxxxxx", n = (new Date).getTime(), e = t.replace(/[xy]/g, function (e) { var t = (n + 16 * Math.random()) % 16 | 0; return n = Math.floor(n / 16), ("x" == e ? t : 7 & t | 8).toString(16) }); return e } }, { key: "ExtensionId", get: function () { return "Viewing.Extension.Base" } }]), t }(l.default.Composer(Autodesk.Viewing.Extension)); t.default = h }, 8: function (e, t, n) { "use strict"; function i(e) { return e && e.__esModule ? e : { default: e } } Object.defineProperty(t, "__esModule", { value: !0 }); var r = n(7), o = i(r); t.default = o.default }, 9: function (e, t) { "use strict"; function n(e) { return function () { var t = e.apply(this, arguments); return new Promise(function (e, n) { function i(r, o) { try { var a = t[r](o), s = a.value } catch (e) { return void n(e) } return a.done ? void e(s) : Promise.resolve(s).then(function (e) { i("next", e) }, function (e) { i("throw", e) }) } return i("next") }) } } function i(e) { if (Array.isArray(e)) { for (var t = 0, n = Array(e.length) ; t < e.length; t++) n[t] = e[t]; return n } return Array.from(e) } function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Object.defineProperty(t, "__esModule", { value: !0 }); var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, a = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var i = t[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } return function (t, n, i) { return n && e(t.prototype, n), i && e(t, i), t } }(), s = function () { function e() { r(this, e) } return a(e, null, [{ key: "guid", value: function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "xxxxxxxxxxxx", n = (new Date).getTime(), e = t.replace(/[xy]/g, function (e) { var t = (n + 16 * Math.random()) % 16 | 0; return n = Math.floor(n / 16), ("x" == e ? t : 7 & t | 8).toString(16) }); return e } }, { key: "getDefaultViewablePath", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : ["3d", "2d"], n = e.getRootItem(), r = [].concat(i(t)), o = []; return r.forEach(function (e) { o = [].concat(i(o), i(Autodesk.Viewing.Document.getSubItemsWithProperties(n, { type: "geometry", role: e }, !0))) }), o.length ? e.getViewablePath(o[0]) : null } }, { key: "createButton", value: function (e, t, n, i) { var r = new Autodesk.Viewing.UI.Button(e); return r.icon.style.fontSize = "24px", r.icon.className = t, r.setToolTip(n), r.onClick = i, r } }, { key: "createControlGroup", value: function (e, t) { var n = e.getToolbar(!0); if (n) { var i = new Autodesk.Viewing.UI.ControlGroup(t); return n.addControl(i), i } } }, { key: "getLeafNodes", value: function (e, t) { return new Promise(function (n, i) { try { var r = e.getData().instanceTree; t = t || r.getRootId(); for (var o = Array.isArray(t) ? t : [t], a = [], s = function e(t) { var n = 0; r.enumNodeChildren(t, function (t) { e(t), ++n }), 0 == n && a.push(t) }, c = 0; c < o.length; ++c) s(o[c]); return n(a) } catch (e) { return i(e) } }) } }, { key: "getFragIds", value: function (t, i) { var r = this; return new Promise(function () { var a = n(regeneratorRuntime.mark(function n(a, s) { var c, l; return regeneratorRuntime.wrap(function (n) { for (; ;) switch (n.prev = n.next) { case 0: return n.prev = 0, n.delegateYield(regeneratorRuntime.mark(function n() { var o, s, l, h; return regeneratorRuntime.wrap(function (n) { for (; ;) switch (n.prev = n.next) { case 0: return o = Array.isArray(i) ? i : [i], s = t.getData().instanceTree, n.next = 4, e.getLeafNodes(t, o); case 4: for (l = n.sent, h = [], c = 0; c < l.length; ++c) s.enumNodeFragments(l[c], function (e) { h.push(e) }); return n.abrupt("return", { v: a(h) }); case 8: case "end": return n.stop() } }, n, r) })(), "t0", 2); case 2: if (l = n.t0, "object" !== ("undefined" == typeof l ? "undefined" : o(l))) { n.next = 5; break } return n.abrupt("return", l.v); case 5: n.next = 10; break; case 7: return n.prev = 7, n.t1 = n.catch(0), n.abrupt("return", s(n.t1)); case 10: case "end": return n.stop() } }, n, r, [[0, 7]]) })); return function (e, t) { return a.apply(this, arguments) } }()) } }, { key: "getWorldBoundingBox", value: function (t, i) { var r = this; return new Promise(function () { var o = n(regeneratorRuntime.mark(function n(o, a) { var s, c, l, h; return regeneratorRuntime.wrap(function (n) { for (; ;) switch (n.prev = n.next) { case 0: return n.prev = 0, n.next = 3, e.getFragIds(t, i); case 3: if (s = n.sent, s.length) { n.next = 6; break } return n.abrupt("return", a("No geometry, invalid dbId?")); case 6: return c = t.getFragmentList(), l = new THREE.Box3, h = new THREE.Box3, s.forEach(function (e) { c.getWorldBounds(e, l), h.union(l) }), n.abrupt("return", o(h)); case 13: return n.prev = 13, n.t0 = n.catch(0), n.abrupt("return", a(n.t0)); case 16: case "end": return n.stop() } }, n, r, [[0, 13]]) })); return function (e, t) { return o.apply(this, arguments) } }()) } }, { key: "getProperties", value: function (t, n) { var i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; return new Promise(function (r, o) { try { if (i) { var a = i.map(function (i) { return e.getProperty(t, n, i, "Not Available") }); Promise.all(a).then(function (e) { r(e) }) } else t.getProperties(n, function (e) { return e.properties ? r(e.properties) : o("No Properties") }) } catch (e) { return console.log(e), o(e) } }) } }, { key: "getProperty", value: function (e, t, n, i) { return new Promise(function (r, o) { try { e.getProperties(t, function (e) { if (e.properties) { if (e.properties.forEach(function (e) { "function" == typeof n ? n(e.displayName) && r(e) : n === e.displayName && r(e) }), i) return r({ displayValue: i, displayName: n }); o(new Error("Not Found")) } else o(new Error("Error getting properties")) }) } catch (e) { return o(e) } }) } }, { key: "getPropertyList", value: function (t, i) { var r = this; return new Promise(function () { var o = n(regeneratorRuntime.mark(function n(o, a) { var s, c, l; return regeneratorRuntime.wrap(function (n) { for (; ;) switch (n.prev = n.next) { case 0: return n.prev = 0, s = i.map(function (n) { return e.getProperties(t, n) }), n.next = 4, Promise.all(s); case 4: return c = n.sent, l = [], c.forEach(function (e) { e.forEach(function (e) { l.indexOf(e.displayName) < 0 && l.push(e.displayName) }) }), n.abrupt("return", o(l.sort())); case 10: return n.prev = 10, n.t0 = n.catch(0), n.abrupt("return", a(n.t0)); case 13: case "end": return n.stop() } }, n, r, [[0, 10]]) })); return function (e, t) { return o.apply(this, arguments) } }()) } }, { key: "getBulkPropertiesAsync", value: function (e, t, n) { return new Promise(function (i, r) { e.getBulkProperties(t, n, function (e) { i(e) }, function (e) { r(e) }) }) } }, { key: "mapComponentsByProp", value: function (t, i, r, o) { var a = this; return new Promise(function () { var o = n(regeneratorRuntime.mark(function n(o, s) { var c, l, h; return regeneratorRuntime.wrap(function (n) { for (; ;) switch (n.prev = n.next) { case 0: return n.prev = 0, n.next = 3, e.getBulkPropertiesAsync(t, r, [i]); case 3: return c = n.sent, l = c.map(function (e) { return Object.assign({}, e.properties[0], { dbId: e.dbId }) }), h = {}, l.forEach(function (e) { var t = e.displayValue; "string" == typeof t && (t = t.split(":")[0]), h[t] || (h[t] = []), h[t].push(e.dbId) }), n.abrupt("return", o(h)); case 10: return n.prev = 10, n.t0 = n.catch(0), n.abrupt("return", s(n.t0)); case 13: case "end": return n.stop() } }, n, a, [[0, 10]]) })); return function (e, t) { return o.apply(this, arguments) } }()) } }, { key: "runTaskOnDataTree", value: function (e, t) { var n = [], i = function e(i) { var r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null; i.children && i.children.forEach(function (t) { e(t, i) }); var o = t(i, r); n.push(o) }; return i(e), Promise.all(n) } }, { key: "drawBox", value: function (e, t, n) { function i(t, n) { for (var i = [], r = 0; r < t.length; r += 2) { var o = t[r], a = t[r + 1], s = new THREE.Geometry; s.vertices.push(new THREE.Vector3(o.x, o.y, o.z)), s.vertices.push(new THREE.Vector3(a.x, a.y, a.z)), s.computeLineDistances(); var c = new THREE.Line(s, n); e.impl.scene.add(c), i.push(c) } return i } var r = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : null, o = r; o || (o = new THREE.LineBasicMaterial({ color: 16776960, linewidth: 2 }), e.impl.matman().addMaterial("ADN-Material-Line", o, !0)); var a = i([{ x: t.x, y: t.y, z: t.z }, { x: n.x, y: t.y, z: t.z }, { x: n.x, y: t.y, z: t.z }, { x: n.x, y: t.y, z: n.z }, { x: n.x, y: t.y, z: n.z }, { x: t.x, y: t.y, z: n.z }, { x: t.x, y: t.y, z: n.z }, { x: t.x, y: t.y, z: t.z }, { x: t.x, y: n.y, z: n.z }, { x: n.x, y: n.y, z: n.z }, { x: n.x, y: n.y, z: n.z }, { x: n.x, y: n.y, z: t.z }, { x: n.x, y: n.y, z: t.z }, { x: t.x, y: n.y, z: t.z }, { x: t.x, y: n.y, z: t.z }, { x: t.x, y: n.y, z: n.z }, { x: t.x, y: t.y, z: t.z }, { x: t.x, y: n.y, z: t.z }, { x: n.x, y: t.y, z: t.z }, { x: n.x, y: n.y, z: t.z }, { x: n.x, y: t.y, z: n.z }, { x: n.x, y: n.y, z: n.z }, { x: t.x, y: t.y, z: n.z }, { x: t.x, y: n.y, z: n.z }], o); return e.impl.sceneUpdated(!0), a } }, { key: "setMaterial", value: function () { function t(e, t, n) { return i.apply(this, arguments) } var i = n(regeneratorRuntime.mark(function t(n, i, r) { var o, a; return regeneratorRuntime.wrap(function (t) { for (; ;) switch (t.prev = t.next) { case 0: return t.next = 2, e.getFragIds(n, i); case 2: o = t.sent, a = n.getFragmentList(), o.forEach(function (e) { a.setMaterial(e, r) }); case 5: case "end": return t.stop() } }, t, this) })); return t }() }, { key: "buildModelTree", value: function (e) { function t(e) { i.enumNodeChildren(e.dbId, function (r) { var o = null; n ? o = n(r) : (e.children = e.children || [], o = { dbId: r, name: i.getNodeName(r) }, e.children.push(o)), t(o) }) } var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null, i = e.getData().instanceTree, r = i.getRootId(), o = { dbId: r, name: i.getNodeName(r) }; return t(o), o } }, { key: "executeTaskOnModelTree", value: function (e, t) { function n(o) { r.enumNodeChildren(o, function (r) { i.push(t(e, r)), n(r) }) } var i = [], r = e.getData().instanceTree, o = r.getRootId(); return n(o), i } }, { key: "isolateFull", value: function (t) { var i = this, r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null, o = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : []; return new Promise(function () { var a = n(regeneratorRuntime.mark(function n(a, s) { var c, l, h, u; return regeneratorRuntime.wrap(function (n) { for (; ;) switch (n.prev = n.next) { case 0: return n.prev = 0, r = r || t.model, t.isolate(o), c = Array.isArray(o) ? o : [o], n.next = 6, e.getLeafNodes(r, c); case 6: return l = n.sent, n.next = 9, e.getLeafNodes(r); case 9: return h = n.sent, u = h.map(function (e) { return new Promise(function (n) { var i = !l.length || l.indexOf(e) > -1; t.impl.visibilityManager.setNodeOff(e, !i), n() }) }), n.abrupt("return", Promise.all(u)); case 14: return n.prev = 14, n.t0 = n.catch(0), n.abrupt("return", s(n.t0)); case 17: case "end": return n.stop() } }, n, i, [[0, 14]]) })); return function (e, t) { return a.apply(this, arguments) } }()) } }, { key: "mobile", get: function () { return { getUserAgent: function () { return navigator.userAgent }, isAndroid: function () { return this.getUserAgent().match(/Android/i) }, isBlackBerry: function () { return this.getUserAgent().match(/BlackBerry/i) }, isIOS: function () { return this.getUserAgent().match(/iPhone|iPad|iPod/i) }, isOpera: function () { return this.getUserAgent().match(/Opera Mini/i) }, isWindows: function () { return this.isWindowsDesktop() || this.isWindowsMobile() }, isWindowsMobile: function () { return this.getUserAgent().match(/IEMobile/i) }, isWindowsDesktop: function () { return this.getUserAgent().match(/WPDesktop/i) }, isAny: function () { return this.isAndroid() || this.isBlackBerry() || this.isIOS() || this.isWindowsMobile() } } } }]), e }(); t.default = s }, 80: function (e, t) {
			"use strict"; !function () {
				var e = function (e) { THREE.MeshBasicMaterial.call(this), this.depthTest = !1, this.depthWrite = !1, this.side = THREE.FrontSide, this.transparent = !0, this.setValues(e), this.oldColor = this.color.clone(), this.oldOpacity = this.opacity, this.highlight = function (e) { e ? (this.color.setRGB(1, 230 / 255, 3 / 255), this.opacity = 1) : (this.color.copy(this.oldColor), this.opacity = this.oldOpacity) } }; e.prototype = Object.create(THREE.MeshBasicMaterial.prototype); var t = function (e) { THREE.LineBasicMaterial.call(this), this.depthTest = !1, this.depthWrite = !1, this.transparent = !0, this.linewidth = 3, this.setValues(e), this.oldColor = this.color.clone(), this.oldOpacity = this.opacity, this.highlight = function (e) { e ? (this.color.setRGB(1, 230 / 255, 3 / 255), this.opacity = 1) : (this.color.copy(this.oldColor), this.opacity = this.oldOpacity) } }; t.prototype = Object.create(THREE.LineBasicMaterial.prototype), void 0 === THREE.PolyhedronGeometry && (THREE.PolyhedronGeometry = function (e, t, n, i) { function r(e) { var t = e.normalize().clone(); t.index = h.vertices.push(t) - 1; var n = s(e) / 2 / Math.PI + .5, i = c(e) / Math.PI + .5; return t.uv = new THREE.Vector2(n, 1 - i), t } function o(e, t, n) { var i = new THREE.Face3(e.index, t.index, n.index, [e.clone(), t.clone(), n.clone()]); h.faces.push(i), w.copy(e).add(t).add(n).divideScalar(3); var r = s(w); h.faceVertexUvs[0].push([l(e.uv, e, r), l(t.uv, t, r), l(n.uv, n, r)]) } function a(e, t) { for (var n = Math.pow(2, t), i = (Math.pow(4, t), r(h.vertices[e.a])), a = r(h.vertices[e.b]), s = r(h.vertices[e.c]), c = [], l = 0; l <= n; l++) { c[l] = []; for (var u = r(i.clone().lerp(s, l / n)), p = r(a.clone().lerp(s, l / n)), E = n - l, m = 0; m <= E; m++) 0 == m && l == n ? c[l][m] = u : c[l][m] = r(u.clone().lerp(p, m / E)) } for (var l = 0; l < n; l++) for (var m = 0; m < 2 * (n - l) - 1; m++) { var f = Math.floor(m / 2); m % 2 == 0 ? o(c[l][f + 1], c[l + 1][f], c[l][f]) : o(c[l][f + 1], c[l + 1][f + 1], c[l + 1][f]) } } function s(e) { return Math.atan2(e.z, -e.x) } function c(e) { return Math.atan2(-e.y, Math.sqrt(e.x * e.x + e.z * e.z)) } function l(e, t, n) { return n < 0 && 1 === e.x && (e = new THREE.Vector2(e.x - 1, e.y)), 0 === t.x && 0 === t.z && (e = new THREE.Vector2(n / 2 / Math.PI + .5, e.y)), e.clone() } THREE.Geometry.call(this), this.type = "PolyhedronGeometry", this.parameters = { vertices: e, indices: t, radius: n, detail: i }, n = n || 1, i = i || 0; for (var h = this, u = 0, p = e.length; u < p; u += 3) r(new THREE.Vector3(e[u], e[u + 1], e[u + 2])); for (var E = this.vertices, m = [], u = 0, f = 0, p = t.length; u < p; u += 3, f++) { var v = E[t[u]], y = E[t[u + 1]], d = E[t[u + 2]]; m[f] = new THREE.Face3(v.index, y.index, d.index, [v.clone(), y.clone(), d.clone()]) } for (var w = new THREE.Vector3, u = 0, p = m.length; u < p; u++) a(m[u], i); for (var u = 0, p = this.faceVertexUvs[0].length; u < p; u++) { var T = this.faceVertexUvs[0][u], g = T[0].x, x = T[1].x, R = T[2].x, M = Math.max(g, Math.max(x, R)), H = Math.min(g, Math.min(x, R)); M > .9 && H < .1 && (g < .2 && (T[0].x += 1), x < .2 && (T[1].x += 1), R < .2 && (T[2].x += 1)) } for (var u = 0, p = this.vertices.length; u < p; u++) this.vertices[u].multiplyScalar(n); this.mergeVertices(), this.computeFaceNormals(), this.boundingSphere = new THREE.Sphere(new THREE.Vector3, n) }, THREE.PolyhedronGeometry.prototype = Object.create(THREE.Geometry.prototype)), void 0 === THREE.OctahedronGeometry && (THREE.OctahedronGeometry = function (e, t) { this.parameters = { radius: e, detail: t }; var n = [1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1], i = [0, 2, 4, 0, 4, 3, 0, 3, 5, 0, 5, 2, 1, 2, 5, 1, 5, 3, 1, 3, 4, 1, 4, 2]; THREE.PolyhedronGeometry.call(this, n, i, e, t), this.type = "OctahedronGeometry", this.parameters = { radius: e, detail: t } }, THREE.OctahedronGeometry.prototype = Object.create(THREE.Geometry.prototype)), void 0 === THREE.TorusGeometry && (THREE.TorusGeometry = function (e, t, n, i, r) { THREE.Geometry.call(this), this.type = "TorusGeometry", this.parameters = { radius: e, tube: t, radialSegments: n, tubularSegments: i, arc: r }, e = e || 100, t = t || 40, n = n || 8, i = i || 6, r = r || 2 * Math.PI; for (var o = new THREE.Vector3, a = [], s = [], c = 0; c <= n; c++) for (var l = 0; l <= i; l++) { var h = l / i * r, u = c / n * Math.PI * 2; o.x = e * Math.cos(h), o.y = e * Math.sin(h); var p = new THREE.Vector3; p.x = (e + t * Math.cos(u)) * Math.cos(h), p.y = (e + t * Math.cos(u)) * Math.sin(h), p.z = t * Math.sin(u), this.vertices.push(p), a.push(new THREE.Vector2(l / i, c / n)), s.push(p.clone().sub(o).normalize()) } for (var c = 1; c <= n; c++) for (var l = 1; l <= i; l++) { var E = (i + 1) * c + l - 1, m = (i + 1) * (c - 1) + l - 1, f = (i + 1) * (c - 1) + l, v = (i + 1) * c + l, y = new THREE.Face3(E, m, v, [s[E].clone(), s[m].clone(), s[v].clone()]); this.faces.push(y), this.faceVertexUvs[0].push([a[E].clone(), a[m].clone(), a[v].clone()]), y = new THREE.Face3(m, f, v, [s[m].clone(), s[f].clone(), s[v].clone()]), this.faces.push(y), this.faceVertexUvs[0].push([a[m].clone(), a[f].clone(), a[v].clone()]) } this.computeFaceNormals() }, THREE.TorusGeometry.prototype = Object.create(THREE.Geometry.prototype)); var n = function (e, t, n) { var i = new THREE.Geometry; n = n ? n : 1; for (var r = 0; r <= 64 * n; ++r) "x" == t && i.vertices.push(new THREE.Vector3(0, Math.cos(r / 32 * Math.PI), Math.sin(r / 32 * Math.PI)).multiplyScalar(e)), "y" == t && i.vertices.push(new THREE.Vector3(Math.cos(r / 32 * Math.PI), 0, Math.sin(r / 32 * Math.PI)).multiplyScalar(e)), "z" == t && i.vertices.push(new THREE.Vector3(Math.sin(r / 32 * Math.PI), Math.cos(r / 32 * Math.PI), 0).multiplyScalar(e)); return i }, i = function (e, t, n, i, r, o) { var a = new THREE.Geometry, s = new THREE.Mesh(new THREE.CylinderGeometry(e, t, n, i, r, o)); return s.position.y = .5, s.updateMatrix(), a.merge(s.geometry, s.matrix), a }, r = function (e) { var t = new THREE.Geometry; return "X" === e ? t.vertices.push(new THREE.Vector3(0, 0, 0), new THREE.Vector3(1, 0, 0)) : "Y" === e ? t.vertices.push(new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 1, 0)) : "Z" === e && t.vertices.push(new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 0, 1)), t }; THREE.TransformGizmo = function () { var e = this, t = !1, n = !1; this.init = function () { THREE.Object3D.call(this), this.handles = new THREE.Object3D, this.pickers = new THREE.Object3D, this.planes = new THREE.Object3D, this.highlights = new THREE.Object3D, this.hemiPicker = new THREE.Object3D, this.subPickers = new THREE.Object3D, this.add(this.handles), this.add(this.pickers), this.add(this.planes), this.add(this.highlights), this.add(this.hemiPicker), this.add(this.subPickers); var e = new THREE.PlaneBufferGeometry(50, 50, 2, 2), t = new THREE.MeshBasicMaterial({ wireframe: !0 }); t.side = THREE.DoubleSide; var n = { XY: new THREE.Mesh(e, t), YZ: new THREE.Mesh(e, t), XZ: new THREE.Mesh(e, t), XYZE: new THREE.Mesh(e, t) }; this.activePlane = n.XYZE, n.YZ.rotation.set(0, Math.PI / 2, 0), n.XZ.rotation.set(-Math.PI / 2, 0, 0); for (var i in n) n[i].name = i, this.planes.add(n[i]), this.planes[i] = n[i], n[i].visible = !1; this.setupGizmos(), this.activeMode = "", this.traverse(function (e) { if (e instanceof THREE.Mesh) { e.updateMatrix(); var t = new THREE.Geometry; e.geometry instanceof THREE.BufferGeometry && (e.geometry = (new THREE.Geometry).fromBufferGeometry(e.geometry)), t.merge(e.geometry, e.matrix), e.geometry = t, e.position.set(0, 0, 0), e.rotation.set(0, 0, 0), e.scale.set(1, 1, 1) } }) }, this.hide = function () { this.traverse(function (e) { e.visible = !1 }) }, this.show = function () { this.traverse(function (n) { n.visible = !0, n.parent != e.pickers && n.parent != e.hemiPicker || (n.visible = t), n.parent == e.planes && (n.visible = !1) }), this.activePlane.visible = n }, this.highlight = function (e) { this.traverse(function (t) { t.material && t.material.highlight && (t.name == e ? t.material.highlight(!0) : t.material.highlight(!1)) }) }, this.setupGizmos = function () { var e = function (e, t) { for (var n in e) for (var i = e[n].length; i--;) { var r = e[n][i][0], o = e[n][i][1], a = e[n][i][2], s = e[n][i][3]; r.name = n, o && r.position.set(o[0], o[1], o[2]), a && r.rotation.set(a[0], a[1], a[2]), s && (r.visble = s), t.add(r) } }; this.setHandlePickerGizmos(), e(this.handleGizmos, this.handles), e(this.pickerGizmos, this.pickers), e(this.highlightGizmos, this.highlights), e(this.hemiPickerGizmos, this.hemiPicker), e(this.subPickerGizmos, this.subPickers), this.hide(), this.show() } }, THREE.TransformGizmo.prototype = Object.create(THREE.Object3D.prototype), THREE.TransformGizmo.prototype.update = function (e, t) { var n = new THREE.Vector3(0, 0, 0), i = new THREE.Vector3(0, 1, 0), r = new THREE.Matrix4; this.traverse(function (o) { o.name && (o.name.search("E") != -1 ? o.quaternion.setFromRotationMatrix(r.lookAt(t, n, i)) : o.name.search("X") == -1 && o.name.search("Y") == -1 && o.name.search("Z") == -1 || o.quaternion.setFromEuler(e)) }) }, THREE.TransformGizmoTranslate = function () { THREE.TransformGizmo.call(this), this.setHandlePickerGizmos = function () { var n = i(0, .05, .2, 12, 1, !1), o = r("X"), a = r("Y"), s = r("Z"); this.handleGizmos = { X: [[new THREE.Mesh(n, new e({ color: 15805484 })), [.5, 0, 0], [0, 0, -Math.PI / 2]], [new THREE.Line(o, new t({ color: 15805484 }))]], Y: [[new THREE.Mesh(n, new e({ color: 768011 })), [0, .5, 0]], [new THREE.Line(a, new t({ color: 768011 }))]], Z: [[new THREE.Mesh(n, new e({ color: 2895089 })), [0, 0, .5], [Math.PI / 2, 0, 0]], [new THREE.Line(s, new t({ color: 2895089 }))]], XYZ: [[new THREE.Mesh(new THREE.OctahedronGeometry(.1, 0), new e({ color: 16777215, opacity: .25 })), [0, 0, 0], [0, 0, 0]]], XY: [[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29, .29), new e({ color: 16776960, opacity: .25 })), [.15, .15, 0]]], YZ: [[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29, .29), new e({ color: 65535, opacity: .25 })), [0, .15, .15], [0, Math.PI / 2, 0]]], XZ: [[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29, .29), new e({ color: 16711935, opacity: .25 })), [.15, 0, .15], [-Math.PI / 2, 0, 0]]] }, this.pickerGizmos = { X: [[new THREE.Mesh(new THREE.CylinderGeometry(.2, 0, 1, 4, 1, !1), new e({ color: 16711680, opacity: .25 })), [.6, 0, 0], [0, 0, -Math.PI / 2]]], Y: [[new THREE.Mesh(new THREE.CylinderGeometry(.2, 0, 1, 4, 1, !1), new e({ color: 65280, opacity: .25 })), [0, .6, 0]]], Z: [[new THREE.Mesh(new THREE.CylinderGeometry(.2, 0, 1, 4, 1, !1), new e({ color: 255, opacity: .25 })), [0, 0, .6], [Math.PI / 2, 0, 0]]], XYZ: [[new THREE.Mesh(new THREE.OctahedronGeometry(.2, 0), new e({ color: 16777215, opacity: .25 }))]], XY: [[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4, .4), new e({ color: 16776960, opacity: .25 })), [.2, .2, 0]]], YZ: [[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4, .4), new e({ color: 65535, opacity: .25 })), [0, .2, .2], [0, Math.PI / 2, 0]]], XZ: [[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4, .4), new e({ color: 16711935, opacity: .25 })), [.2, 0, .2], [-Math.PI / 2, 0, 0]]] }, this.hemiPickerGizmos = { XYZ: [[new THREE.Mesh(new THREE.BoxGeometry(1.2, 1.2, 1.2), new e({ color: 255 })), [.5, .5, .5], null, !1]] } }, this.setActivePlane = function (e, t) { var n = new THREE.Matrix4; t.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))), "X" == e && (this.activePlane = this.planes.XY, Math.abs(t.y) > Math.abs(t.z) && (this.activePlane = this.planes.XZ)), "Y" == e && (this.activePlane = this.planes.XY, Math.abs(t.x) > Math.abs(t.z) && (this.activePlane = this.planes.YZ)), "Z" == e && (this.activePlane = this.planes.XZ, Math.abs(t.x) > Math.abs(t.y) && (this.activePlane = this.planes.YZ)), "XYZ" == e && (this.activePlane = this.planes.XYZE), "XY" == e && (this.activePlane = this.planes.XY), "YZ" == e && (this.activePlane = this.planes.YZ), "XZ" == e && (this.activePlane = this.planes.XZ), this.hide(), this.show() }, this.init() }, THREE.TransformGizmoTranslate.prototype = Object.create(THREE.TransformGizmo.prototype), THREE.TransformGizmoRotate = function () {
					THREE.TransformGizmo.call(this), this.setHandlePickerGizmos = function () { this.handleGizmos = { RX: [[new THREE.Line(n(1, "x", .5), new t({ color: 16711680 }))]], RY: [[new THREE.Line(n(1, "y", .5), new t({ color: 65280 }))]], RZ: [[new THREE.Line(n(1, "z", .5), new t({ color: 255 }))]], RE: [[new THREE.Line(n(1.25, "z", 1), new t({ color: 65535 }))]], RXYZE: [[new THREE.Line(n(1, "z", 1), new t({ color: 16711935 }))]] }, this.pickerGizmos = { RX: [[new THREE.Mesh(new THREE.TorusGeometry(1, .12, 4, 12, Math.PI), new e({ color: 16711680, opacity: .25 })), [0, 0, 0], [0, -Math.PI / 2, -Math.PI / 2]]], RY: [[new THREE.Mesh(new THREE.TorusGeometry(1, .12, 4, 12, Math.PI), new e({ color: 65280, opacity: .25 })), [0, 0, 0], [Math.PI / 2, 0, 0]]], RZ: [[new THREE.Mesh(new THREE.TorusGeometry(1, .12, 4, 12, Math.PI), new e({ color: 255, opacity: .25 })), [0, 0, 0], [0, 0, -Math.PI / 2]]], RE: [[new THREE.Mesh(new THREE.TorusGeometry(1.25, .12, 2, 24), new e({ color: 65535, opacity: .25 }))]], RXYZE: [[new THREE.Mesh(new THREE.TorusGeometry(1, .12, 2, 24), new e({ color: 16711935, opacity: .25 }))]] } }, this.setActivePlane = function (e) { "RE" == e && (this.activePlane = this.planes.XYZE), "RX" == e && (this.activePlane = this.planes.YZ), "RY" == e && (this.activePlane = this.planes.XZ), "RZ" == e && (this.activePlane = this.planes.XY), this.hide(), this.show() }, this.update = function (e, t) {
						THREE.TransformGizmo.prototype.update.apply(this, arguments); var n = new THREE.Matrix4, i = new THREE.Euler(0, 0, 1), r = new THREE.Quaternion, o = new THREE.Vector3(1, 0, 0), a = new THREE.Vector3(0, 1, 0), s = new THREE.Vector3(0, 0, 1), c = new THREE.Quaternion, l = new THREE.Quaternion, h = new THREE.Quaternion, u = t.clone(); i.copy(this.planes.XY.rotation), r.setFromEuler(i), n.makeRotationFromQuaternion(r).getInverse(n), u.applyMatrix4(n), this.traverse(function (e) {
							r.setFromEuler(i), "RX" == e.name && (c.setFromAxisAngle(o, Math.atan2(-u.y, u.z)), r.multiplyQuaternions(r, c), e.quaternion.copy(r)), "RY" == e.name && (l.setFromAxisAngle(a, Math.atan2(u.x, u.z)), r.multiplyQuaternions(r, l),
e.quaternion.copy(r)),"RZ"==e.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),r.multiplyQuaternions(r,h),e.quaternion.copy(r))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this);var t=this;this.setHandlePickerGizmos=function(){var t=i(0,.05,.2,12,1,!1),n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0));var r=.15;this.handleGizmos={Z:[[new THREE.Mesh(t,new e({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new e({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,2*r*Math.PI),new e({color:16711680})),[0,0,0],[r*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new e({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,2*r*Math.PI),new e({color:255})),[0,0,0],[Math.PI/2,0,(.5-r)*Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new e({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,2*r*Math.PI),new e({color:16711680,opacity:.25})),[0,0,0],[r*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,2*r*Math.PI),new e({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,(.5-r)*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8,0,Math.PI),new e({color:255})),null,null,!1]]}},this.setActivePlane=function(e,t){if("translate"==this.activeMode){var n=new THREE.Matrix4;t.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==e&&(this.activePlane=this.planes.YZ),"RY"==e&&(this.activePlane=this.planes.XZ),"RZ"==e&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(e,t){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),r=new THREE.Quaternion,o=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,h=new THREE.Quaternion,u=t.clone();i.copy(this.planes.XY.rotation),r.setFromEuler(i),n.makeRotationFromQuaternion(r).getInverse(n),u.applyMatrix4(n),this.traverse(function(e){r.setFromEuler(i),"RX"==e.name&&(c.setFromAxisAngle(o,Math.atan2(-u.y,u.z)),r.multiplyQuaternions(r,c),e.quaternion.copy(r)),"RY"==e.name&&(l.setFromAxisAngle(a,Math.atan2(u.x,u.z)),r.multiplyQuaternions(r,l),e.quaternion.copy(r)),"RZ"==e.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),r.multiplyQuaternions(r,h),e.quaternion.copy(r))})}},this.show=function(){this.traverse(function(e){(null==t.parent||t.parent.useAllPickers||e.parent!=t.handles)&&(e.visible=!0),e.material&&(e.material.opacity=e.material.oldOpacity),e.parent!=t.pickers&&e.parent!=t.hemiPicker&&e.parent!=t.subPickers||(e.visible=!1),e.parent!=t.planes&&e.parent!=t.highlights||(e.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(e){this.traverse(function(n){n.material&&n.material.highlight&&(n.name==e?(n.parent!=t.highlights&&n.parent!=t.handles||(n.visible=!0),n.material.highlight(!0)):(n.material.highlight(!1),n.material.opacity=.1))})},this.init()},THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var n=i(.125,.125,.125),o=r("X"),a=r("Y"),s=r("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new e({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(o,new t({color:16711680}))]],Y:[[new THREE.Mesh(n,new e({color:65280})),[0,.5,0]],[new THREE.Line(a,new t({color:65280}))]],Z:[[new THREE.Mesh(n,new e({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(s,new t({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new e({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new e({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(e,t){var n=new THREE.Matrix4;t.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(e,t,n){function i(n,i){var r=t.getBoundingClientRect(),o=(n.clientX-r.left)/r.width*2-1,a=2*-((n.clientY-r.top)/r.height)+1;e.isPerspective?(w.set(o,a,.5),w.unproject(e),d.set(e.position,w.sub(e.position).normalize())):(w.set(o,a,-1),w.unproject(e),T.set(0,0,-1),d.set(w,T.transformDirection(e.matrixWorld)));var s=d.intersectObjects(i,!0);return!!s[0]&&s[0]}switch(THREE.Object3D.call(this),t=void 0!==t?t:document,this.gizmo={},n){case"translate":this.gizmo[n]=new THREE.TransformGizmoTranslate;break;case"rotate":this.gizmo[n]=new THREE.TransformGizmoRotate;break;case"transrotate":this.gizmo[n]=new THREE.TransformGizmoTranslateRotate;break;case"scale":this.gizmo[n]=new THREE.TransformGizmoScale}if(this.add(this.gizmo[n]),this.gizmo[n].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===n){var r=new THREE.Geometry;r.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));var o=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(r,o);var r=new THREE.Geometry,o=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});r.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.endLine=new THREE.Line(r,o);var r=new THREE.Geometry,o=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});r.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)),this.centerLine=new THREE.Line(r,o);var a=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"));a.magFilter=a.minFilter=THREE.NearestFilter;var r=new THREE.CircleGeometry(.1,32),o=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:a});this.centerMark=new THREE.Mesh(r,o),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={};var a=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"));a.magFilter=a.minFilter=THREE.NearestFilter;var o=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:a}),s=.12,c=.25,l=1.15;this.ticks.RX=new THREE.Object3D;var r=new THREE.PlaneBufferGeometry(s,c),h=new THREE.Mesh(r,o);h.position.set(0,0,-l-c/2),h.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(h),h=h.clone(),h.position.set(0,l+c/2,0),h.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(h),h=h.clone(),h.position.set(0,0,l+c/2),h.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(h),h=h.clone(),h.position.set(0,-l-c/2,0),h.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(h),this.ticks.RY=new THREE.Object3D,h=h.clone(),h.position.set(0,0,-l-c/2),h.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(h),h=h.clone(),h.position.set(-l-c/2,0,0),h.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(h),h=h.clone(),h.position.set(0,0,l+c/2),h.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(h),h=h.clone(),h.position.set(l+c/2,0,0),h.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(h)}var u=this,p=!1,E=n,m={type:"change"},f={type:"mouseDown"},v={type:"mouseUp",mode:E},y={type:"objectChange"},d=new THREE.Raycaster,w=new THREE.Vector3,T=new THREE.Vector3,g=new THREE.Vector3,x=new THREE.Vector3,R=new THREE.Vector3,M=new THREE.Vector3,H=1,b=new THREE.Matrix4,P=new THREE.Vector3,z=new THREE.Matrix4,_=new THREE.Vector3,k=new THREE.Quaternion,C=new THREE.Vector3,G=new THREE.Vector3,I=new THREE.Vector3,A=new THREE.Quaternion,V=new THREE.Quaternion,j=new THREE.Quaternion,O=new THREE.Quaternion,X=new THREE.Quaternion,Y=new THREE.Vector3,L=new THREE.Vector3,S=new THREE.Matrix4,Z=new THREE.Matrix4,F=new THREE.Vector3,D=new THREE.Vector3,B=new THREE.Euler,N=new THREE.Matrix4,U=new THREE.Vector3;new THREE.Euler;this.attach=function(e){u.object=e,this.gizmo[E].show(),u.update(),u.updateUnitVectors()},this.detach=function(e){u.object=void 0,this.axis=null,this.gizmo[E].hide()},this.setMode=function(e){E=e?e:E,"scale"==E&&(u.space="local"),this.gizmo[E].show(),this.update(),u.dispatchEvent(m)},this.getPicker=function(){return u.gizmo[E].hemiPicker.children},this.setPosition=function(e){this.object.position.copy(e),this.update()},this.setNormal=function(e){k.setFromUnitVectors(this.normal,e),this.unitX.applyQuaternion(k),this.unitY.applyQuaternion(k),this.unitZ.applyQuaternion(k),this.normal.copy(e),this.object&&this.object.quaternion.multiply(k),this.update()},this.setSnap=function(e,t){u.snap=e,u.snapDelta=t},this.setSize=function(e){u.size=e,this.update(),u.dispatchEvent(m)},this.setSpace=function(e){u.space=e,this.update(),u.dispatchEvent(m)},this.update=function(n){if(void 0!==u.object){u.object.updateMatrixWorld(),D.setFromMatrixPosition(u.object.matrixWorld),B.setFromRotationMatrix(z.extractRotation(u.object.matrixWorld)),e.updateMatrixWorld(),U.setFromMatrixPosition(e.matrixWorld),this.position.copy(D),this.quaternion.setFromEuler(B),this.normal.set(0,0,1),this.normal.applyEuler(B);var i=D.distanceTo(U),r=e.isPerspective?2*Math.tan(e.fov*Math.PI/360)*i:i,o=t.getBoundingClientRect();H=100*r/o.height,this.scale.set(H,H,H),n&&this.gizmo[E].highlight(u.axis)}},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(B),this.unitY.applyEuler(B),this.unitZ.applyEuler(B)},this.showRotationGizmos=function(e){for(var t=this.gizmo[E].handles.children,n=0;n<t.length;n++){var i=t[n];i.visible=!0,i.name.search("R")!==-1&&(i.visible=e)}this.useAllPickers=e},this.highlight=function(){this.gizmo[E].highlight(this.axis||"Z")},this.onPointerHover=function(e){if(void 0===u.object||p===!0)return!1;var t=e.pointers?e.pointers[0]:e,n=i(t,u.useAllPickers?u.gizmo[E].pickers.children:u.gizmo[E].subPickers.children),r=null,o="";return n&&(r=n.object.name,o=r.search("R")!=-1?"rotate":"translate"),u.axis!==r&&(u.axis=r,u.gizmo[E].activeMode=o,u.update(!0),u.dispatchEvent(m)),null===u.axis&&u.gizmo[E].show(),!!n},this.onPointerDown=function(t){if(void 0===u.object||p===!0)return!1;var n=t.pointers?t.pointers[0]:t;if("touch"===t.pointerType){var r=i(n,u.useAllPickers?u.gizmo[E].pickers.children:u.gizmo[E].subPickers.children),o=null,a="";r&&(o=r.object.name,a=o.search("R")!=-1?"rotate":"translate"),u.axis!==o&&(u.axis=o,u.gizmo[E].activeMode=a)}var r=null;if((0===n.button||void 0===n.button)&&(r=i(n,u.useAllPickers?u.gizmo[E].pickers.children:u.gizmo[E].subPickers.children))){u.dispatchEvent(f),u.axis=r.object.name,u.update(),P.copy(e.position).sub(D).normalize(),u.gizmo[E].setActivePlane(u.axis,P);var s=i(n,[u.gizmo[E].activePlane]);if(s&&x.copy(s.point),Y.copy(u.object.position),L.copy(u.object.scale),S.extractRotation(u.object.matrix),N.extractRotation(u.object.matrixWorld),u.object.parent?(Z.extractRotation(u.object.parent.matrixWorld),F.setFromMatrixScale(z.getInverse(u.object.parent.matrixWorld))):(Z.extractRotation(u.object.matrixWorld),F.setFromMatrixScale(z.getInverse(u.object.matrixWorld))),"transrotate"===E&&"rotate"===u.gizmo[E].activeMode){u.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(u.matrixWorld),u.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(u.matrixWorld),u.startLine.geometry.verticesNeedUpdate=!0,u.parent.add(u.startLine);var c=u.object.geometry.getAttribute("position"),l=(new THREE.Vector3).fromAttribute(c,0).applyMatrix4(u.object.matrixWorld),h=(new THREE.Vector3).fromAttribute(c,1).applyMatrix4(u.object.matrixWorld),m=(new THREE.Vector3).fromAttribute(c,2).applyMatrix4(u.object.matrixWorld),v=(new THREE.Vector3).fromAttribute(c,3).applyMatrix4(u.object.matrixWorld);if("RX"===u.axis){l.lerp(m,.5),h.lerp(v,.5);var y=l.distanceTo(h);u.centerLine.material.dashSize=y/15,u.centerLine.material.gapSize=y/30,u.centerLine.geometry.vertices[0].copy(l),u.centerLine.geometry.vertices[1].copy(h)}else{l.lerp(h,.5),m.lerp(v,.5);var y=l.distanceTo(m);u.centerLine.material.dashSize=y/15,u.centerLine.material.gapSize=y/30,u.centerLine.geometry.vertices[0].copy(l),u.centerLine.geometry.vertices[1].copy(m)}u.centerLine.geometry.computeLineDistances(),u.centerLine.geometry.verticesNeedUpdate=!0,u.parent.add(u.centerLine),u.ticks[u.axis].position.copy(u.position),u.ticks[u.axis].quaternion.copy(u.quaternion),u.ticks[u.axis].scale.copy(u.scale),u.parent.add(u.ticks[u.axis])}}return p=!0,!!r},this.onPointerMove=function(e){if(void 0===u.object||null===u.axis||p===!1)return!1;var t=e.pointers?e.pointers[0]:e,n=i(t,[u.gizmo[E].activePlane]);n&&g.copy(n.point);var r=u.gizmo[E].activeMode;if("translate"==r)g.sub(x),g.multiply(F),"local"==u.space&&(g.applyMatrix4(z.getInverse(N)),C.copy(this.unitX),G.copy(this.unitY),I.copy(this.unitZ),_.set(0,0,0),u.axis.search("X")!=-1&&(C.multiplyScalar(g.dot(this.unitX)),_.add(C)),u.axis.search("Y")!=-1&&(G.multiplyScalar(g.dot(this.unitY)),_.add(G)),u.axis.search("Z")!=-1&&(I.multiplyScalar(g.dot(this.unitZ)),_.add(I)),g.copy(_),g.applyMatrix4(S),u.object.position.copy(Y),u.object.position.add(g)),"world"!=u.space&&u.axis.search("XYZ")==-1||(C.copy(this.unitX),G.copy(this.unitY),I.copy(this.unitZ),_.set(0,0,0),u.axis.search("X")!=-1&&(C.multiplyScalar(g.dot(this.unitX)),_.add(C)),u.axis.search("Y")!=-1&&(G.multiplyScalar(g.dot(this.unitY)),_.add(G)),u.axis.search("Z")!=-1&&(I.multiplyScalar(g.dot(this.unitZ)),_.add(I)),g.copy(_),g.applyMatrix4(z.getInverse(Z)),u.object.position.copy(Y),u.object.position.add(g));else if("scale"==r)g.sub(x),g.multiply(F),"local"==u.space&&("XYZ"==u.axis?(H=1+g.y/50,u.object.scale.x=L.x*H,u.object.scale.y=L.y*H,u.object.scale.z=L.z*H):(g.applyMatrix4(z.getInverse(N)),"X"==u.axis&&(u.object.scale.x=L.x*(1+g.x/50)),"Y"==u.axis&&(u.object.scale.y=L.y*(1+g.y/50)),"Z"==u.axis&&(u.object.scale.z=L.z*(1+g.z/50))));else if("rotate"==r){if(g.sub(D),g.multiply(F),_.copy(x).sub(D),_.multiply(F),"RE"==u.axis){g.applyMatrix4(z.getInverse(b)),_.applyMatrix4(z.getInverse(b)),R.set(Math.atan2(g.z,g.y),Math.atan2(g.x,g.z),Math.atan2(g.y,g.x)),M.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),k.setFromRotationMatrix(z.getInverse(Z));var o=R.z-M.z;if(null!==u.snap){var a=Math.round(o/u.snap)*u.snap;Math.abs(a-o)<u.snapDelta&&(o=a)}X.setFromAxisAngle(P,o),A.setFromRotationMatrix(N),k.multiplyQuaternions(k,X),k.multiplyQuaternions(k,A),u.object.quaternion.copy(k)}else if("RXYZE"==u.axis){var s=g.clone().cross(_).normalize();k.setFromRotationMatrix(z.getInverse(Z));var c=-g.clone().angleTo(_);if(null!==u.snap){var a=Math.round(c/u.snap)*u.snap;Math.abs(a-c)<u.snapDelta&&(c=a)}V.setFromAxisAngle(s,c),A.setFromRotationMatrix(N),k.multiplyQuaternions(k,V),k.multiplyQuaternions(k,A),u.object.quaternion.copy(k)}else if("local"==u.space){g.applyMatrix4(z.getInverse(N)),_.applyMatrix4(z.getInverse(N));var l=g.dot(this.unitX),h=g.dot(this.unitY),f=g.dot(this.unitZ),v=_.dot(this.unitX),d=_.dot(this.unitY),w=_.dot(this.unitZ);R.set(Math.atan2(f,h),Math.atan2(l,f),Math.atan2(h,l)),M.set(Math.atan2(w,d),Math.atan2(v,w),Math.atan2(d,v));var T=R.x-M.x,B=R.y-M.y,o=R.z-M.z;if(null!==u.snap){if(u.axis.search("X")!=-1){var a=Math.round(T/u.snap)*u.snap;Math.abs(a-T)<u.snapDelta&&(T=a)}if(u.axis.search("Y")!=-1){var a=Math.round(B/u.snap)*u.snap;Math.abs(a-B)<u.snapDelta&&(B=a)}if(u.axis.search("Z")!=-1){var a=Math.round(o/u.snap)*u.snap;Math.abs(a-o)<u.snapDelta&&(o=a)}}V.setFromAxisAngle(this.unitX,T),j.setFromAxisAngle(this.unitY,B),O.setFromAxisAngle(this.unitZ,o),A.setFromRotationMatrix(S),"RX"==u.axis&&A.multiplyQuaternions(A,V),"RY"==u.axis&&A.multiplyQuaternions(A,j),"RZ"==u.axis&&A.multiplyQuaternions(A,O),u.object.quaternion.copy(A)}else if("world"==u.space){var l=g.dot(this.unitX),h=g.dot(this.unitY),f=g.dot(this.unitZ),v=_.dot(this.unitX),d=_.dot(this.unitY),w=_.dot(this.unitZ);R.set(Math.atan2(f,h),Math.atan2(l,f),Math.atan2(h,l)),M.set(Math.atan2(w,d),Math.atan2(v,w),Math.atan2(d,v)),k.setFromRotationMatrix(z.getInverse(Z));var T=R.x-M.x,B=R.y-M.y,o=R.z-M.z;if(null!==u.snap){if(u.axis.search("X")!=-1){var a=Math.round(T/u.snap)*u.snap;Math.abs(a-T)<u.snapDelta&&(T=a)}if(u.axis.search("Y")!=-1){var a=Math.round(B/u.snap)*u.snap;Math.abs(a-B)<u.snapDelta&&(B=a)}if(u.axis.search("Z")!=-1){var a=Math.round(o/u.snap)*u.snap;Math.abs(a-o)<u.snapDelta&&(o=a)}}V.setFromAxisAngle(this.unitX,T),j.setFromAxisAngle(this.unitY,B),O.setFromAxisAngle(this.unitZ,o),A.setFromRotationMatrix(N),"RX"==u.axis&&k.multiplyQuaternions(k,V),"RY"==u.axis&&k.multiplyQuaternions(k,j),"RZ"==u.axis&&k.multiplyQuaternions(k,O),k.multiplyQuaternions(k,A),u.object.quaternion.copy(k)}"transrotate"===E&&(u.add(u.endLine),u.add(u.centerMark))}return u.object.matrixAutoUpdate=!0,u.update(!0),u.dispatchEvent(m),u.dispatchEvent(y),!!n},this.onPointerUp=function(e){return p&&null!==u.axis&&(v.mode=E,u.dispatchEvent(v)),p=!1,this.gizmo[E].show(),this.updateUnitVectors(),"transrotate"===E&&"rotate"===this.gizmo[E].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}()},81:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=n(2),l=i(c),h=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.keys={},n.active=!1,n.viewer=e,n.fullTransform=!1,n.viewer.toolController.registerTool(n),n.onAggregateSelectionChangedHandler=function(e){n.onAggregateSelectionChanged(e)},n}return a(t,e),s(t,[{key:"enable",value:function(e){var t=this.getName();e?this.viewer.toolController.activateTool(t):this.viewer.toolController.deactivateTool(t)}},{key:"getNames",value:function(){return["Viewing.Rotate.Tool"]}},{key:"getName",value:function(){return"Viewing.Rotate.Tool"}},{key:"activate",value:function(){this.active||(this.active=!0,this.viewer.addEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChangedHandler))}},{key:"deactivate",value:function(){this.active&&(this.active=!1,this.rotateControl&&(this.rotateControl.remove(),this.rotateControl=null),this.viewer.removeEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChangedHandler))}},{key:"onAggregateSelectionChanged",value:function(e){if(this.rotateControl&&this.rotateControl.engaged)return this.rotateControl.engaged=!1,void this.viewer.select(this.selection.dbIdArray);if(e.selections&&e.selections.length){var t=e.selections[0];if(this.selection=t,this.emit("transform.modelSelected",this.selection),this.fullTransform){this.selection.fragIdsArray=[];for(var n=t.model.getFragmentList().fragments.fragId2dbId.length,i=0;i<n;++i)this.selection.fragIdsArray.push(i);this.selection.dbIdArray=[];var r=t.model.getData().instanceTree,o=r.getRootId();this.selection.dbIdArray.push(o)}this.drawControl(),this.viewer.fitToView(this.selection.dbIdArray)}else this.clearSelection()}},{key:"clearSelection",value:function(){this.selection=null,this.rotateControl&&(this.rotateControl.remove(),this.rotateControl=null,this.viewer.impl.sceneUpdated(!0))}},{key:"drawControl",value:function(){var e=this,t=this.geWorldBoundingBox(this.selection.fragIdsArray,this.selection.model.getFragmentList());this.center=new THREE.Vector3((t.min.x+t.max.x)/2,(t.min.y+t.max.y)/2,(t.min.z+t.max.z)/2);var n=.8*Math.max(t.max.x-t.min.x,t.max.y-t.min.y,t.max.z-t.min.z);this.rotateControl&&this.rotateControl.remove(),this.rotateControl=new u(this.viewer,this.center,n),this.rotateControl.on("transform.rotate",function(t){e.rotateFragments(e.selection.model,e.selection.fragIdsArray,t.axis,t.angle,e.center),e.viewer.impl.sceneUpdated(!0)})}},{key:"handleButtonDown",value:function(e,t){return!(!this.rotateControl||!this.rotateControl.onPointerDown(e))||!(0!==t||!this.keys.Control)&&(this.isDragging=!0,this.mousePos={x:e.clientX,y:e.clientY},!0)}},{key:"handleButtonUp",value:function(e,t){return this.rotateControl&&this.rotateControl.onPointerUp(e),0===t&&(this.isDragging=!1),!1}},{key:"handleMouseMove",value:function(e){if(this.rotateControl&&this.rotateControl.onPointerHover(e),this.isDragging){if(this.selection){var t={x:this.mousePos.x-e.clientX,y:e.clientY-this.mousePos.y};this.mousePos={x:e.clientX,y:e.clientY};var n=Math.sqrt(t.x*t.x+t.y*t.y),i=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3,s=this.viewer.getCamera(),c=new THREE.Vector3,l=new THREE.Vector3;l.copy(s.position).sub(s.target),o.copy(l).normalize(),a.copy(s.up).normalize(),i.crossVectors(a,o).normalize(),a.setLength(t.y),i.setLength(t.x),r.copy(a.add(i)),c.crossVectors(r,l).normalize(),this.rotateFragments(this.selection.model,this.selection.fragIdsArray,c,n*Math.PI/180,this.center),this.viewer.impl.sceneUpdated(!0)}return!0}return!1}},{key:"handleKeyDown",value:function(e,t){return this.keys[e.key]=!0,!1}},{key:"handleKeyUp",value:function(e,t){return this.keys[e.key]=!1,!1}},{key:"rotateFragments",value:function(e,t,n,i,r){var o=this,a=new THREE.Quaternion;a.setFromAxisAngle(n,i),t.forEach(function(t,n){var i=o.viewer.impl.getFragmentProxy(e,t);i.getAnimTransform();var s=new THREE.Vector3(i.position.x-r.x,i.position.y-r.y,i.position.z-r.z);if(s.applyQuaternion(a),s.add(r),i.position=s,i.quaternion.multiplyQuaternions(a,i.quaternion),0===n){var c=new THREE.Euler;c.setFromQuaternion(i.quaternion,0),o.emit("transform.rotate",{rotation:c,model:e})}i.updateAnimTransform()})}},{key:"geWorldBoundingBox",value:function(e,t){var n=new THREE.Box3,i=new THREE.Box3;return e.forEach(function(e){t.getWorldBounds(e,n),i.union(n)}),i}}]),t}(l.default);t.default=h;var u=function(e){function t(e,n,i){r(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));a.engaged=!1,a.overlayScene="rotateControlScene",a.domElement=e.impl.canvas,a.camera=e.impl.camera,a.viewer=e,a.center=n,a.size=i,a.gizmos=[],a.viewer.impl.createOverlayScene(a.overlayScene),a.createAxis(n,new THREE.Vector3(1,0,0),.85*i,16711680),a.createAxis(n,new THREE.Vector3(0,1,0),.85*i,65280),a.createAxis(n,new THREE.Vector3(0,0,1),.85*i,255),a.camera.worldup.y?(a.gizmos.push(a.createGizmo(n,new THREE.Euler(0,Math.PI/2,0),.0045*i,.8*i,16711680,Math.PI,new THREE.Vector3(1,0,0))),a.gizmos.push(a.createGizmo(n,new THREE.Euler(Math.PI/2,0,0),.0045*i,.8*i,65280,2*Math.PI,new THREE.Vector3(0,1,0))),a.gizmos.push(a.createGizmo(n,new THREE.Euler(0,0,0),.0045*i,.8*i,255,Math.PI,new THREE.Vector3(0,0,1)))):(a.gizmos.push(a.createGizmo(n,new THREE.Euler(Math.PI/2,Math.PI/2,0),.0045*i,.8*i,16711680,Math.PI,new THREE.Vector3(1,0,0))),a.gizmos.push(a.createGizmo(n,new THREE.Euler(Math.PI/2,0,0),.0045*i,.8*i,65280,Math.PI,new THREE.Vector3(0,1,0))),a.gizmos.push(a.createGizmo(n,new THREE.Euler(0,0,0),.0045*i,.8*i,255,2*Math.PI,new THREE.Vector3(0,0,1)))),a.picker=a.createSphere(.02*i);var s=new THREE.LineBasicMaterial({color:16776960,linewidth:1,depthTest:!1,depthWrite:!1,transparent:!0});return a.angleLine=a.createLine(a.center,a.center,s),e.impl.sceneUpdated(!0),a}return a(t,e),s(t,[{key:"createLine",value:function(e,t,n){var i=new THREE.Geometry;i.vertices.push(new THREE.Vector3(e.x,e.y,e.z)),i.vertices.push(new THREE.Vector3(t.x,t.y,t.z));var r=new THREE.Line(i,n);return this.viewer.impl.addOverlay(this.overlayScene,r),r}},{key:"createCone",value:function(e,t,n,i){t.normalize();var r={x:e.x+t.x*n,y:e.y+t.y*n,z:e.z+t.z*n},o=new THREE.Matrix4;o.lookAt(e,r,(new THREE.Object3D).up);var a=new THREE.Matrix4;a.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),o.multiply(a);var s=new THREE.CylinderGeometry(0,.2*n,n,128,1),c=new THREE.Mesh(s,i);return c.applyMatrix(o),c.position.x=e.x+t.x*n/2,c.position.y=e.y+t.y*n/2,c.position.z=e.z+t.z*n/2,this.viewer.impl.addOverlay(this.overlayScene,c),c}},{key:"createAxis",value:function(e,t,n,i){var r={x:e.x+t.x*n,y:e.y+t.y*n,z:e.z+t.z*n},o=new THREE.LineBasicMaterial({color:i,linewidth:3,depthTest:!1,depthWrite:!1,transparent:!0});this.createLine(e,r,o),this.createCone(r,t,.1*n,o)}},{key:"createGizmo",value:function(e,t,n,i,r,o,a){var s=new p({color:r}),c=new p({color:r}),l=new THREE.Mesh(new THREE.TorusGeometry(i,n,64,64,o),s),h=new THREE.Mesh(new THREE.TorusGeometry(i,n,64,64,2*Math.PI),c);h.material.highlight(!0);var u=new THREE.Matrix4,E=new THREE.Quaternion;E.setFromEuler(t);var m=new THREE.Vector3(1,1,1);u.compose(e,E,m),l.applyMatrix(u),h.applyMatrix(u);var f=this.createBox(100*this.size,100*this.size,.01);return f.applyMatrix(u),h.visible=!1,this.viewer.impl.addOverlay(this.overlayScene,l),this.viewer.impl.addOverlay(this.overlayScene,h),l.subGizmo=h,l.plane=f,l.axis=a,l}},{key:"createBox",value:function(e,t,n){var i=new p({color:0}),r=new THREE.BoxGeometry(e,t,n),o=new THREE.Mesh(r,i);return o.visible=!1,this.viewer.impl.addOverlay(this.overlayScene,o),o}},{key:"createSphere",value:function(e){var t=new p({color:16776960}),n=new THREE.SphereGeometry(e,32,32),i=new THREE.Mesh(n,t);return i.visible=!1,this.viewer.impl.addOverlay(this.overlayScene,i),i}},{key:"pointerToRaycaster",value:function(e){var t=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Raycaster,r=this.domElement.getBoundingClientRect(),o=(e.clientX-r.left)/r.width*2-1,a=2*-((e.clientY-r.top)/r.height)+1;return this.camera.isPerspective?(t.set(o,a,.5),t.unproject(this.camera),i.set(this.camera.position,t.sub(this.camera.position).normalize())):(t.set(o,a,-1),t.unproject(this.camera),n.set(0,0,-1),i.set(t,n.transformDirection(this.camera.matrixWorld))),i}},{key:"onPointerDown",value:function(e){var t=e.pointers?e.pointers[0]:e;if(0===t.button){var n=this.pointerToRaycaster(t),i=n.intersectObjects(this.gizmos,!0);i.length?(this.gizmos.forEach(function(e){e.visible=!1}),this.selectedGizmo=i[0].object,this.selectedGizmo.subGizmo.visible=!0,this.picker.position.copy(i[0].point),this.angleLine.geometry.vertices[1].copy(i[0].point),this.lastDir=i[0].point.sub(this.center).normalize(),this.angleLine.geometry.verticesNeedUpdate=!0,this.angleLine.visible=!0,this.picker.visible=!0):this.picker.visible=!1,this.engaged=this.picker.visible,this.viewer.impl.sceneUpdated(!0)}return this.picker.visible}},{key:"onPointerHover",value:function(e){var t=e.pointers?e.pointers[0]:e;if(this.engaged){var n=this.pointerToRaycaster(t),i=n.intersectObjects([this.selectedGizmo.plane],!0);if(i.length){var r=i[0].point,o=r.sub(this.center).normalize(),a=new THREE.Vector3;a.crossVectors(this.lastDir,o);var s=Math.sign(a.dot(this.selectedGizmo.axis));this.emit("transform.rotate",{angle:s*o.angleTo(this.lastDir),axis:this.selectedGizmo.axis}),this.lastDir=o;var c=new THREE.Vector3(this.center.x+o.x*this.size*.8,this.center.y+o.y*this.size*.8,this.center.z+o.z*this.size*.8);this.picker.position.copy(c),this.angleLine.geometry.vertices[1].copy(c)}this.angleLine.visible=!0,this.angleLine.geometry.verticesNeedUpdate=!0}else{this.angleLine.visible=!1;var n=this.pointerToRaycaster(t),i=n.intersectObjects(this.gizmos,!0);i.length?(this.picker.position.set(i[0].point.x,i[0].point.y,i[0].point.z),this.picker.visible=!0):this.picker.visible=!1}this.viewer.impl.sceneUpdated(!0)}},{key:"onPointerUp",value:function(e){var t=this;this.angleLine.visible=!1,this.picker.visible=!1,this.gizmos.forEach(function(e){e.visible=!0,e.subGizmo.visible=!1}),this.viewer.impl.sceneUpdated(!0),setTimeout(function(){t.engaged=!1},100)}},{key:"normalize",value:function(e){var t=this.viewer.navigation.getScreenViewport(),n={x:(e.x-t.left)/t.width,y:(e.y-t.top)/t.height};return n}},{key:"projectOntoPlane",value:function(e,t){var n=t.dot(e);return new THREE.Vector3(e.x-n*t.x,e.y-n*t.y,e.z-n*t.z)}},{key:"remove",value:function(){this.viewer.impl.removeOverlayScene(this.overlayScene)}}]),t}(l.default),p=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setValues(e),n.colorInit=n.color.clone(),n.opacityInit=n.opacity,n.side=THREE.FrontSide,n.depthWrite=!1,n.transparent=!0,n.depthTest=!1,n}return a(t,e),s(t,[{key:"highlight",value:function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.colorInit),this.opacity=this.opacityInit)}}]),t}(THREE.MeshBasicMaterial)},82:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){
var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=n(2),l=i(c);n(80);var h=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.active=!1,n._viewer=e,n._hitPoint=null,n._isDragging=!1,n.fullTransform=!1,n._transformMesh=null,n._transformControlTx=null,n._selectedFragProxyMap={},n.onTxChange=n.onTxChange.bind(n),n.onAggregateSelectionChanged=n.onAggregateSelectionChanged.bind(n),n.onCameraChanged=n.onCameraChanged.bind(n),n}return a(t,e),s(t,[{key:"getNames",value:function(){return["Viewing.Transform.Tool"]}},{key:"getName",value:function(){return"Viewing.Transform.Tool"}},{key:"createTransformMesh",value:function(){var e=new THREE.MeshPhongMaterial({color:16711680});this._viewer.impl.matman().addMaterial("transform-tool-material",e,!0);var t=new THREE.Mesh(new THREE.SphereGeometry(1e-4,5),e);return t.position.set(0,0,0),t}},{key:"onTxChange",value:function(){if(this._isDragging&&this._transformControlTx.visible){var e=new THREE.Vector3(this._transformMesh.position.x-this._selection.model.offset.x,this._transformMesh.position.y-this._selection.model.offset.y,this._transformMesh.position.z-this._selection.model.offset.z);for(var t in this._selectedFragProxyMap){var n=this._selectedFragProxyMap[t],i=new THREE.Vector3(this._transformMesh.position.x-n.offset.x,this._transformMesh.position.y-n.offset.y,this._transformMesh.position.z-n.offset.z);n.position=i,n.updateAnimTransform()}this.emit("transform.translate",{model:this._selection.model,translation:e})}this._viewer.impl.sceneUpdated(!0)}},{key:"onCameraChanged",value:function(){this._transformControlTx&&this._transformControlTx.update()}},{key:"onAggregateSelectionChanged",value:function(e){if(e.selections&&e.selections.length){if(this._selection=e.selections[0],this.fullTransform){this._selection.fragIdsArray=[];for(var t=this._selection.model.getFragmentList().fragments.fragId2dbId.length,n=0;n<t;++n)this._selection.fragIdsArray.push(n);this._selection.dbIdArray=[];var i=this._selection.model.getData().instanceTree,r=i.getRootId();this._selection.dbIdArray.push(r)}this.emit("transform.modelSelected",this._selection),this.initializeSelection(this._hitPoint)}else this.clearSelection()}},{key:"initializeSelection",value:function(e){var t=this;this._selectedFragProxyMap={};var n=this._selection.model.transform||{translation:{x:0,y:0,z:0}};this._selection.model.offset={x:e.x-n.translation.x,y:e.y-n.translation.y,z:e.z-n.translation.z},this._transformControlTx.visible=!0,this._transformControlTx.setPosition(e),this._transformControlTx.addEventListener("change",this.onTxChange),this._viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this._selection.fragIdsArray.forEach(function(n){var i=t._viewer.impl.getFragmentProxy(t._selection.model,n);i.getAnimTransform(),i.offset={x:e.x-i.position.x,y:e.y-i.position.y,z:e.z-i.position.z},t._selectedFragProxyMap[n]=i})}},{key:"clearSelection",value:function(){this.active&&(this._selection=null,this._selectedFragProxyMap={},this._transformControlTx.visible=!1,this._transformControlTx.removeEventListener("change",this.onTxChange),this._viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this._viewer.impl.sceneUpdated(!0))}},{key:"normalize",value:function(e){var t=this._viewer.navigation.getScreenViewport(),n={x:(e.x-t.left)/t.width,y:(e.y-t.top)/t.height};return n}},{key:"getHitPoint",value:function(e){var t={x:e.clientX,y:e.clientY},n=this.normalize(t),i=this._viewer.utilities.getHitPoint(n.x,n.y);return i}},{key:"activate",value:function(){if(!this.active){this.active=!0,this._viewer.select([]);var e=this._viewer.model.getBoundingBox();this._viewer.impl.createOverlayScene("TransformToolOverlay"),this._transformControlTx=new THREE.TransformControls(this._viewer.impl.camera,this._viewer.impl.canvas,"translate"),this._transformControlTx.setSize(5*e.getBoundingSphere().radius),this._transformControlTx.visible=!1,this._viewer.impl.addOverlay("TransformToolOverlay",this._transformControlTx),this._transformMesh=this.createTransformMesh(),this._transformControlTx.attach(this._transformMesh),this._viewer.addEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChanged)}}},{key:"deactivate",value:function(){this.active&&(this.active=!1,this._viewer.impl.removeOverlay("TransformToolOverlay",this._transformControlTx),this._transformControlTx.removeEventListener("change",this.onTxChange),this._viewer.impl.removeOverlayScene("TransformToolOverlay"),this._viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this._viewer.removeEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChanged))}},{key:"handleButtonDown",value:function(e,t){return this._hitPoint=this.getHitPoint(e),this._isDragging=!0,!!this._transformControlTx.onPointerDown(e)}},{key:"handleButtonUp",value:function(e,t){return this._isDragging=!1,!!this._transformControlTx.onPointerUp(e)}},{key:"handleMouseMove",value:function(e){return this._isDragging?!!this._transformControlTx.onPointerMove(e):!!this._transformControlTx.onPointerHover(e)}}]),t}(l.default);t.default=h}})});